class Solution {

    int m;
    int n;
    int dirs[4][2] = { {0,1}, {0,-1}, {1,0}, {-1,0} };

    bool isMovePossible(int x, int y) {
        return 0 <= x && x < m && 0 <= y && y < n;
    }

    void dfs(vector<vector<int>> &heights, vector<vector<bool>> &visited, int x, int y) {
        
        visited[x][y] = true;

        for(auto dir : dirs) {
            int i = x + dir[0], j = y + dir[1];

            if(isMovePossible(i, j) && !visited[i][j] && heights[x][y] <= heights[i][j])
                dfs(heights, visited, i, j);
        }
    }

public:
    vector<vector<int>> pacificAtlantic(vector<vector<int>>& heights) {
        
        m = heights.size();
        n = heights[0].size();

        vector<vector<bool>> pacific(m, vector<bool>(n, false));
        vector<vector<bool>> atlantic(m, vector<bool>(n, false));

        for(int x = 0; x < m; x++) {
            dfs(heights, pacific, x, 0);
            dfs(heights, atlantic, x, n-1);
        }

        for(int y = 0; y < n; y++) {
            dfs(heights, pacific, 0, y);
            dfs(heights, atlantic, m-1, y);
        }

        // Collect cells reachable by both oceans
        vector<vector<int>> res;
        
        for (int i = 0; i < m; i++)
            for (int j = 0; j < n; j++)
                if (pacific[i][j] && atlantic[i][j])
                    res.push_back({i, j});

        return res;
    }
};
